<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>PDF edit and create</title>

<style>
  TEXTAREA { width:400px; height: 4em; background-color: lightyellow; }
  TD { vertical-align: top; }
</style>
<script type="text/javascript">

function Send(msg) {
  try {
    var http = new XMLHttpRequest();
    http.open('POST', '/', false);
    //xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded; charset=UTF-8");
    //xmlhttp.setRequestHeader("Content-Length", XMLtoSend.length);
    http.send(msg);
    
    alert(http.responseText); return http.responseText;
/*    
    var J = JSON.parse(http.responseText);
    alert('File: ' + J.file + '\nCollection: ' + J.collection + '\nAction: ' + J.action + '\nTheme: ' + J.theme + '\nContent: ' + J.content  + '\nServer: ' + J.server  + '\nModified: ' + J.modified.toString() );
    return J;
    1 - if ok, null if doesn't exist, ...list, ...0-error
*/
  } catch(e) { alert(e.message); return 'Error!'; }
}

function buldTable( txt ) {
  var x = JSON.parse(txt), L = x.length, t = '<table>';
  for(var i=0; i<L; i++) t += '<TR><td><input type="text" onChange="Rename(this)" value="' + x[i].file + '" ref="'+ x[i]._id +'"></td><td>' + getDF(x[i].modified) + '</td><td></TR>';
  id('out').innerHTML = t + '</table>';
}

function getDF(x){
  var s = (new Date(x)).toString().split(' ');
  return s[0] + ',&nbsp;' + s[2] + '&nbsp;' + s[1] + ',&nbsp;' + s[4];
}

function Rename( ob ) {
  
  var xID = ob.getAttribute('ref');
  alert('id = ' + xID);
  
  var J = {};
  J.collection = 'files';
  J.id = ob.getAttribute('ref');
  J.file = ob.value.trim();
  J.action = 'rename';
  Send( JSON.stringify(J) );

  listIt();
}

function listIt() {
  var J = {};
  J.collection = 'files';
  J.action = 'list';
  buldTable( Send( JSON.stringify(J) ));
}


function id(x) { return document.getElementById(x); }
function getAndSend( ob ) {
  var J = {};
  J.collection = 'files';
  J.file = id('title').value.trim();
  J.theme = id('theme').value.trim();
  J.content = id('content').value.trim();
  J.action = ob.options[ob.selectedIndex].text;
  Send( JSON.stringify(J) );
}

</script>
</head>
<body>

<table>
  <tr>
    <td>Action:</td>
    <td>
      <select onChange='getAndSend(this)'>
        <option>list</option>
        <option>save</option>
        <option>remove</option>
        <option>rename</option>
        <option>get one</option>
      </select>
    </td>
  </tr>
  <tr>
    <td>File:</td>
    <td>
      <TEXTAREA id='title'>
      A new PDF file/title.
      </TEXTAREA>
    </td>
  </tr>
  <tr>
    <td>Theme:</td>
    <td>
      <TEXTAREA id='theme'>
      Primul. Un oarecare text.
      </TEXTAREA>
    </td>
  </tr>
  <tr>
    <td>Content:</td>
    <td>
      <TEXTAREA id='content'>
      Al doilea. Un oarecare text.
      </TEXTAREA>
    </td>
  </tr>
</table>

<input type='button' onclick='listIt()' value='List!'><br>
<div id='out'></div>
</body>
</html>
